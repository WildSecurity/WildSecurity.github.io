<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Debugging Elastic Pipelines" /><meta property="og:locale" content="en" /><meta name="description" content="Over the past weeks I have been migrating to Elasticsearch 8.x with Fleet Agents. This brought some more annoying challenges, namely debugging Ingest Pipelines and trying to figure out how this could be done in a more relaxed way. So here we go." /><meta property="og:description" content="Over the past weeks I have been migrating to Elasticsearch 8.x with Fleet Agents. This brought some more annoying challenges, namely debugging Ingest Pipelines and trying to figure out how this could be done in a more relaxed way. So here we go." /><link rel="canonical" href="https://wilddogone.github.io//posts/Debugging_Ingest_Pipelines/" /><meta property="og:url" content="https://wilddogone.github.io//posts/Debugging_Ingest_Pipelines/" /><meta property="og:site_name" content="About Security" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-12T10:08:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Debugging Elastic Pipelines" /><meta name="twitter:site" content="@none" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-08-12T10:44:29+02:00","datePublished":"2022-08-12T10:08:00+02:00","description":"Over the past weeks I have been migrating to Elasticsearch 8.x with Fleet Agents. This brought some more annoying challenges, namely debugging Ingest Pipelines and trying to figure out how this could be done in a more relaxed way. So here we go.","headline":"Debugging Elastic Pipelines","mainEntityOfPage":{"@type":"WebPage","@id":"https://wilddogone.github.io//posts/Debugging_Ingest_Pipelines/"},"url":"https://wilddogone.github.io//posts/Debugging_Ingest_Pipelines/"}</script><title>Debugging Elastic Pipelines | About Security</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="About Security"><meta name="application-name" content="About Security"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/avatar.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">About Security</a></div><div class="site-subtitle font-italic">Blue and Red</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/WildDogOne" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/none" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Debugging Elastic Pipelines</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Debugging Elastic Pipelines</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/WildDogOne/">WildDogOne</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1660291680" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-08-12 </em> </span> <span> Updated <em class="timeago" data-ts="1660293869" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-08-12 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1043 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><p>Over the past weeks I have been migrating to Elasticsearch 8.x with Fleet Agents. This brought some more annoying challenges, namely debugging Ingest Pipelines and trying to figure out how this could be done in a more relaxed way. So here we go.</p><h2 id="the-ingest-pipelines"><span class="mr-2">The Ingest Pipelines</span><a href="#the-ingest-pipelines" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>First let’s get into what Ingest Pipelines are, and how they work.</p><h3 id="what-are-they"><span class="mr-2">What are they?</span><a href="#what-are-they" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Dumbed down, they are a way to run an ELK Stack without the L (Logstash) part.</p><p>So basically we have log source, which either gets Pulled or Pushed to Filebeat and from there via an Ingest Pipeline to an Elasticsearch Index. The Ingest Pipelines are part of Elasticsearch nodes (they need the “ingest” role) and will handle extracting data from the incoming events. Basically if you know Logstash and Grok, yes Pipelines also have a Grok Processer etc. Of course Ingest Pipelines are much more complicated than that, but for now this is enough to get you started.</p><p>Here is a very basic design of how this process could look.</p><script type="text/javascript" src="/assets/js/mermaid.js"></script><div class="mermaid"> %%{init: {"theme": "dark"}}%%; graph LR; LS[Log Source] --&gt; Filebeat; Filebeat --&gt; IP[Ingest Pipeline]; subgraph Elasticsearch; IP --&gt; |Process Data| IP; IP --&gt; ES[Elasticsearch Index]; end;</div><p>And here one with Fleet integration, we will mostly talk about the fleet version, but it’s pretty much the same to Filebeat without fleet.</p><script type="text/javascript" src="/assets/js/mermaid.js"></script><div class="mermaid"> %%{init: {"theme": "dark"}}%%; graph LR; EAS -.-&gt; |Pull Config| ES; EAS[Fleet Server] -..-&gt; |Push Config| EA; EA[Elastic Agent] -..-&gt; |Push Config| Filebeat; LS[Log Source] ---&gt;|Send Data| Filebeat; Filebeat ---&gt; |Send Data| IP[Ingest Pipeline]; subgraph Elasticsearch; IP --&gt; |Process Data| IP; IP ---&gt; |Index Data| ES[Elasticsearch Index]; end;</div><h3 id="where-do-they-come-from"><span class="mr-2">Where do they come from?</span><a href="#where-do-they-come-from" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>So now that we know what an Ingest Pipeline is, where the fuck do they come from? Basically there are 3 ways to get one.</p><ul><li>From Fleet<li>From Filebeat<li>Manually made</ul><p>Focus here of course on Fleet, but basically Filebeat can push Ingest Pipeline config to Elasticsearch. The Fleet uses Integrations, which are either automatically or manually updated. These Integrations build the Ingest Pipeline and an Index Template (for Linking the Index to the correct Ingest Pipeline). I personally would not enable automated updating of Ingest Pipelines, but you do you ;)</p><h3 id="and-what-if-it-fails"><span class="mr-2">And what if it fails?</span><a href="#and-what-if-it-fails" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Now that, is the actual question I had to answer for myself. If an Ingest Pipeline fails, it will run through “failure processors”. Usually these Processors look something like this:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"set"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error.message"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">""</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre></table></code></div></div><p>This will set a field called “error.message” to the value of the failed processors dying words. So yes, we will have an error message in the document. However, we have zero idea which Ingest Pipeline failed, and even if we knew that, we still don’t know which processor failed. So to make it simple, the default error handling of Ingest Pipelines is not actually usable. It will just tell you something fucked up, and now you’re sherlock, go do your thing.</p><p>Luckily in the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/ingest.html#handling-pipeline-failures">official documentation</a> there is a bit of information about other on_failure fields.</p><ul><li>on_failure_message<li>on_failure_processor_type<li>on_failure_processor_tag<li>on_failure_pipeline</ul><p>From this list we can already see, the field “on_failure_pipeline” is very interesting, because it will tell us which pipeline failed, a little side note here, I have seen this field to not yield anything. On top of that the “on_failure_processor_type” is interesting because it will tell us what failed on a processor (the processor itself or for example a condition). And the last one “on_failure_processor_tag” is interesting because it will throw out the tags of a processor. However, a processor by default doesn’t have tags, so let’s fix that later.</p><p>All in all I build my failure processor like this (yes I stole that from the documentation):</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"append"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error.message"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"Processor  with tag  in pipeline  failed with message: "</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre></table></code></div></div><p>Now this will really help us a lot already, even without tags. Speaking of tags, I am not sure how good of an idea it is to set too many, may have a performance impact. Anyway, we have a processor now, and we can attach this to every Ingest Pipeline by hand……? Or we could do some simple scripting to automatically set the processor.</p><p>Sample Script: (since on_failure_pipeline sometimes fails, I decided to use the pipeline name instead)</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">elasticsearch</span> <span class="kn">import</span> <span class="n">Elasticsearch</span>


<span class="k">def</span> <span class="nf">get_pipelines</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">es</span><span class="p">.</span><span class="n">ingest</span><span class="p">.</span><span class="n">get_pipeline</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">put_pipelines</span><span class="p">(</span><span class="n">es</span><span class="p">,</span> <span class="n">pipelines</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="s">"logs_"</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">pipeline_name</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">search</span> <span class="ow">in</span> <span class="n">pipeline_name</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">)</span>
      <span class="n">failure_processor</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s">"append"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"field"</span><span class="p">:</span> <span class="s">"error.message"</span><span class="p">,</span>
            <span class="s">"value"</span><span class="p">:</span> <span class="p">[</span>
              <span class="s">'Processor "" with tag "" in pipeline "'</span>
              <span class="o">+</span> <span class="n">pipeline_name</span>
              <span class="o">+</span> <span class="s">'" failed with message: ""'</span>
            <span class="p">],</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
      <span class="n">es</span><span class="p">.</span><span class="n">ingest</span><span class="p">.</span><span class="n">put_pipeline</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="n">pipeline_name</span><span class="p">,</span>
        <span class="n">processors</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">][</span><span class="s">"processors"</span><span class="p">],</span>
        <span class="n">on_failure</span><span class="o">=</span><span class="n">failure_processor</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">][</span><span class="s">"description"</span><span class="p">],</span>
      <span class="p">)</span>


<span class="n">es</span> <span class="o">=</span> <span class="n">Elasticsearch</span><span class="p">(</span>
  <span class="s">"elastic_hosts"</span><span class="p">,</span>
  <span class="n">basic_auth</span><span class="o">=</span><span class="p">(</span><span class="s">"username"</span><span class="p">,</span> <span class="s">"password"</span><span class="p">),</span>
  <span class="n">verify_certs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
  <span class="n">ca_certs</span><span class="o">=</span><span class="s">"../ca.crt"</span><span class="p">,</span>
  <span class="n">request_timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
  <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">pipelines</span> <span class="o">=</span> <span class="n">get_pipelines</span><span class="p">(</span><span class="n">es</span><span class="p">)</span>
<span class="n">put_pipelines</span><span class="p">(</span><span class="n">es</span><span class="p">,</span> <span class="n">pipelines</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="s">"logs_"</span><span class="p">)</span>
</pre></table></code></div></div><p>This script will attach our processor to all Ingest Pipelines that have the word “logs_” in the name. Since every pipeline starting with logs_ has the same default failure processors, it’s pretty safe to overwrite them.</p><p>Now we are set for error messages. We can use the “error.message” field to debug our problems. As soon as I get an error.message I usually identify the pipeline, and then add tags to all processors inside of it. For this I have another little script</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">put_pipelines_tags</span><span class="p">(</span><span class="n">es</span><span class="p">,</span> <span class="n">pipelines</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="s">"logs_cisco.asa"</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">pipeline_name</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">search</span> <span class="ow">in</span> <span class="n">pipeline_name</span><span class="p">:</span>
      <span class="n">processors</span> <span class="o">=</span> <span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">][</span><span class="s">"processors"</span><span class="p">]</span>
      <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"Processing </span><span class="si">{</span><span class="n">pipeline_name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
      <span class="n">stepper</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">for</span> <span class="n">processor</span> <span class="ow">in</span> <span class="n">processors</span><span class="p">:</span>
        <span class="c1"># pprint(processor)
</span>        <span class="k">for</span> <span class="n">processor_type</span> <span class="ow">in</span> <span class="n">processor</span><span class="p">:</span>
          <span class="n">processor</span><span class="p">[</span><span class="n">processor_type</span><span class="p">][</span><span class="s">"tag"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stepper</span><span class="p">)</span>
          <span class="n">stepper</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># pprint(processor)
</span>      <span class="n">es</span><span class="p">.</span><span class="n">ingest</span><span class="p">.</span><span class="n">put_pipeline</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="n">pipeline_name</span><span class="p">,</span>
        <span class="n">processors</span><span class="o">=</span><span class="n">processors</span><span class="p">,</span>
        <span class="n">on_failure</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">][</span><span class="s">"on_failure"</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline_name</span><span class="p">][</span><span class="s">"description"</span><span class="p">],</span>
      <span class="p">)</span>


<span class="n">put_pipelines_tags</span><span class="p">(</span><span class="n">es</span><span class="p">,</span> <span class="n">pipelines</span><span class="p">)</span>
</pre></table></code></div></div><p>And like this, I get a very good indicator of what failed and where. Now the only last thing to do is, use our brains to find out what went wrong. Or just set the processor to ignore failures.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/elastic/'>elastic</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/elastic/" class="post-tag no-text-decoration" >elastic</a> <a href="/tags/howto/" class="post-tag no-text-decoration" >howto</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Debugging Elastic Pipelines - About Security&amp;url=https://wilddogone.github.io//posts/Debugging_Ingest_Pipelines/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Debugging Elastic Pipelines - About Security&amp;u=https://wilddogone.github.io//posts/Debugging_Ingest_Pipelines/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://wilddogone.github.io//posts/Debugging_Ingest_Pipelines/&amp;text=Debugging Elastic Pipelines - About Security" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Debugging_Ingest_Pipelines/">Debugging Elastic Pipelines</a><li><a href="/posts/Elastic_Risk_Model/">Building a Risk Model in Elastic</a><li><a href="/posts/Building_Security/">Building Home Security</a><li><a href="/posts/Elastic_Security/">Building Elastic Security</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/elastic/">elastic</a> <a class="post-tag" href="/tags/howto/">howto</a> <a class="post-tag" href="/tags/hunting/">hunting</a> <a class="post-tag" href="/tags/mde/">mde</a> <a class="post-tag" href="/tags/false-positive/">false positive</a> <a class="post-tag" href="/tags/true-positive/">true positive</a> <a class="post-tag" href="/tags/elastalert/">elastalert</a> <a class="post-tag" href="/tags/m365/">m365</a> <a class="post-tag" href="/tags/psexec/">psexec</a> <a class="post-tag" href="/tags/thehive/">thehive</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Building_Security/"><div class="card-body"> <em class="timeago small" data-ts="1654789140" > 2022-06-09 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building Home Security</h3><div class="text-muted small"><p> Recently I have been revamping my home security setup. In this Blog I will try and reflect on what all used to build it and how I am planning to improve. Architecture %%{init: {&quot;theme&quot;: &quot;dark&quot;...</p></div></div></a></div><div class="card"> <a href="/posts/Elastic_Security/"><div class="card-body"> <em class="timeago small" data-ts="1654792800" > 2022-06-09 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building Elastic Security</h3><div class="text-muted small"><p> Recently I have started to rebuild my home security setup. This included getting my Elastic Security up and running again. And in this blog entry I want to write a bit about it. However, since Elas...</p></div></div></a></div><div class="card"> <a href="/posts/Elastic_Risk_Model/"><div class="card-body"> <em class="timeago small" data-ts="1659119940" > 2022-07-29 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building a Risk Model in Elastic</h3><div class="text-muted small"><p> Lately I have been thinking about how to do a risk scoring model in Elasticsearch. Yes I am aware that there are risk models for users and for hosts But these are heavily dependent on machine learn...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Elastic_Risk_Model/" class="btn btn-outline-primary" prompt="Older"><p>Building a Risk Model in Elastic</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/WildDogOne/">WildDogOne</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/elastic/">elastic</a> <a class="post-tag" href="/tags/howto/">howto</a> <a class="post-tag" href="/tags/hunting/">hunting</a> <a class="post-tag" href="/tags/mde/">mde</a> <a class="post-tag" href="/tags/false-positive/">false positive</a> <a class="post-tag" href="/tags/true-positive/">true positive</a> <a class="post-tag" href="/tags/elastalert/">elastalert</a> <a class="post-tag" href="/tags/m365/">m365</a> <a class="post-tag" href="/tags/psexec/">psexec</a> <a class="post-tag" href="/tags/thehive/">thehive</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
